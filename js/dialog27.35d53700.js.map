{"version":3,"sources":["webpack:///./shell/dialog/RotateCertificatesDialog.vue","webpack:///shell/dialog/RotateCertificatesDialog.vue","webpack:///./shell/dialog/RotateCertificatesDialog.vue?3061","webpack:///./shell/dialog/RotateCertificatesDialog.vue?c385","webpack:///./shell/dialog/RotateCertificatesDialog.vue?d5f2","webpack:///./shell/dialog/RotateCertificatesDialog.vue?2b1d","webpack:///./shell/dialog/RotateCertificatesDialog.vue?c3f9"],"names":["render","_vm","this","_c","_self","staticClass","style","attrs","scopedSlots","_u","key","fn","_v","_s","t","proxy","_l","errors","error","i","value","label","model","rotateAllServices","callback","$$v","expression","class","serviceOptions","selectedService","slot","on","close","rotate","staticRenderFns","components","Select","RadioGroup","Card","AsyncButton","Banner","props","cluster","type","Object","default","data","computed","isRke2","options","isK3s","push","sort","schema","$store","getters","get","actionParams","services","caCertificates","mounted","methods","$emit","buttonDone","_this","_asyncToGenerator","_regeneratorRuntime","mark","_callee","params","_this$cluster$spec","_this$cluster$spec$rk","_this$cluster$spec$rk2","currentGeneration","wrap","_context","prev","next","spec","rkeConfig","rotateCertificates","generation","set","save","mgmt","doAction","t0","exceptionToErrorsArray","stop","component","___CSS_LOADER_API_IMPORT___","exports","module","content","__esModule","locals","add"],"mappings":"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","file":"js/dialog27.35d53700.js","sourcesContent":["var render = function render(){var _vm=this,_c=_vm._self._c;return _c('Card',{staticClass:\"prompt-rotate\",style:({'height':'100%'}),attrs:{\"show-highlight-border\":false},scopedSlots:_vm._u([{key:\"title\",fn:function(){return [_c('h3',[_vm._v(_vm._s(_vm.t('cluster.rotateCertificates.modalTitle')))])]},proxy:true},{key:\"body\",fn:function(){return [_vm._l((_vm.errors),function(error,i){return _c('Banner',{key:i,attrs:{\"color\":\"error\",\"label\":error}})}),_vm._v(\" \"),_c('div',{staticClass:\"options\"},[_c('RadioGroup',{attrs:{\"name\":\"service-mode\",\"options\":[\n          {\n            value: true,\n            label:_vm.t('cluster.rotateCertificates.allServices')\n          },\n          {\n            value: false,\n            label:_vm.t('cluster.rotateCertificates.selectService')\n          }\n        ]},model:{value:(_vm.rotateAllServices),callback:function ($$v) {_vm.rotateAllServices=$$v},expression:\"rotateAllServices\"}}),_vm._v(\" \"),_c('Select',{staticClass:\"service-select\",class:{'invisible': _vm.rotateAllServices},attrs:{\"options\":_vm.serviceOptions},model:{value:(_vm.selectedService),callback:function ($$v) {_vm.selectedService=$$v},expression:\"selectedService\"}})],1)]},proxy:true}])},[_vm._v(\" \"),_vm._v(\" \"),_c('div',{staticClass:\"buttons\",attrs:{\"slot\":\"actions\"},slot:\"actions\"},[_c('button',{staticClass:\"btn role-secondary mr-20\",on:{\"click\":_vm.close}},[_vm._v(\"\\n      \"+_vm._s(_vm.t('generic.cancel'))+\"\\n    \")]),_vm._v(\" \"),_c('AsyncButton',{attrs:{\"mode\":\"rotate\",\"disabled\":!_vm.rotateAllServices && !_vm.selectedService},on:{\"click\":_vm.rotate}})],1)])\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<script>\nimport { Card } from '@components/Card';\nimport AsyncButton from '@shell/components/AsyncButton';\nimport { Banner } from '@components/Banner';\n\nimport { RadioGroup } from '@components/Form/Radio';\nimport Select from '@shell/components/form/Select';\n\nimport { get, set } from '@shell/utils/object';\nimport { exceptionToErrorsArray } from '@shell/utils/error';\n\nexport default {\n  components: {\n    Select,\n    RadioGroup,\n    Card,\n    AsyncButton,\n    Banner\n  },\n\n  props: {\n    cluster: {\n      type:    Object,\n      default: () => {\n        return {};\n      }\n    }\n  },\n\n  data() {\n    return {\n      selectedService:   '',\n      rotateAllServices: true,\n      errors:            []\n    };\n  },\n\n  computed: {\n    serviceOptions() {\n      if (this.cluster.isRke2) {\n        const options = [\n          'admin',\n          'api-server',\n          'controller-manager',\n          'scheduler',\n          'cloud-controller',\n          'etcd',\n          'auth-proxy',\n          'kubelet',\n          'kube-proxy'\n        ];\n\n        if ( this.cluster.isK3s ) {\n          options.push('k3s-controller', 'k3s-server');\n        } else {\n          options.push('rke2-controller', 'rke2-server');\n        }\n\n        return options.sort();\n      }\n      // For RKE1 clusters, Norman provides the list of service options:\n      // type RotateCertificateInput struct {\n      //   CACertificates bool     `json:\"caCertificates,omitempty\"`\n      //   Services       []string `json:\"services,omitempty\" norman:\"type=enum,options=etcd|kubelet|kube-apiserver|kube-proxy|kube-scheduler|kube-controller-manager\"`\n      // }\n      const schema = this.$store.getters['rancher/schemaFor']('rotatecertificateinput');\n\n      return get(schema, 'resourceFields.services.options') || [];\n    },\n\n    actionParams() {\n      if (this.rotateAllServices) {\n        return {\n          // To rotate all services, RKE1 clusters need services\n          // to be null, while RKE2 requires an empty array.\n          services:       this.cluster.isRke2 ? [] : null,\n          caCertificates: false,\n        };\n      } else {\n        return {\n          services:       this.selectedService,\n          caCertificates: false,\n        };\n      }\n    }\n  },\n\n  mounted() {\n    this.selectedService = this.serviceOptions[0] || '';\n  },\n\n  methods: {\n    close() {\n      this.$emit('close');\n    },\n\n    async rotate(buttonDone) {\n      const params = this.actionParams;\n\n      try {\n        if (this.cluster.isRke2) {\n        // The Steve API doesn't support actions, so for RKE2 cluster cert rotation, we patch the cluster.\n          const currentGeneration = this.cluster.spec?.rkeConfig?.rotateCertificates?.generation || 0;\n\n          set(this.cluster, 'spec.rkeConfig.rotateCertificates', {\n            generation: currentGeneration + 1,\n            services:   (this.selectedService && !this.rotateAllServices) ? [this.selectedService] : []\n          });\n\n          await this.cluster.save();\n        } else {\n          await this.cluster.mgmt.doAction('rotateCertificates', params);\n        }\n        buttonDone(true);\n        this.close();\n      } catch (err) {\n        this.errors = exceptionToErrorsArray(err);\n        buttonDone(false);\n      }\n    }\n  }\n};\n</script>\n\n<template>\n  <Card\n    class=\"prompt-rotate\"\n    :show-highlight-border=\"false\"\n    :style=\"{'height':'100%'}\"\n  >\n    <template #title>\n      <h3>{{ t('cluster.rotateCertificates.modalTitle') }}</h3>\n    </template>\n    <template #body>\n      <Banner\n        v-for=\"(error, i) in errors\"\n        :key=\"i\"\n        class=\"\"\n        color=\"error\"\n        :label=\"error\"\n      />\n      <div class=\"options\">\n        <RadioGroup\n          v-model=\"rotateAllServices\"\n          name=\"service-mode\"\n          :options=\"[\n            {\n              value: true,\n              label:t('cluster.rotateCertificates.allServices')\n            },\n            {\n              value: false,\n              label:t('cluster.rotateCertificates.selectService')\n            }\n          ]\"\n        />\n        <Select\n          v-model=\"selectedService\"\n          :options=\"serviceOptions\"\n          class=\"service-select\"\n          :class=\"{'invisible': rotateAllServices}\"\n        />\n      </div>\n    </template>\n    <div\n      slot=\"actions\"\n      class=\"buttons\"\n    >\n      <button\n        class=\"btn role-secondary mr-20\"\n        @click=\"close\"\n      >\n        {{ t('generic.cancel') }}\n      </button>\n      <AsyncButton\n        mode=\"rotate\"\n        :disabled=\"!rotateAllServices && !selectedService\"\n        @click=\"rotate\"\n      />\n    </div>\n  </Card>\n</template>\n\n<style lang='scss' scoped>\n  .prompt-rotate {\n    margin: 0;\n  }\n  .buttons {\n    display: flex;\n    justify-content: flex-end;\n    width: 100%;\n  }\n  .options {\n    display: flex;\n    flex-direction: column;\n\n    .service-select {\n      margin-left: 20px;\n      margin-top: 10px;\n      width: fit-content;\n      min-width: 260px;\n    }\n  }\n\n.rotate-modal ::v-deep.v--modal-box{\n  border:none;\n\n  & .card-container{\n    margin: 0;\n\n    & .card-wrap {\n      display:flex;\n      flex-direction:column;\n    }\n\n    & .card-body {\n      flex: 1;\n    }\n\n    & .card-actions{\n      align-self: center\n    };\n  }\n}\n</style>\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--16-0!../../node_modules/babel-loader/lib/index.js??ref--16-1!../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js??vue-loader-options!./RotateCertificatesDialog.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--16-0!../../node_modules/babel-loader/lib/index.js??ref--16-1!../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js??vue-loader-options!./RotateCertificatesDialog.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./RotateCertificatesDialog.vue?vue&type=template&id=41281ab8&scoped=true&\"\nimport script from \"./RotateCertificatesDialog.vue?vue&type=script&lang=js&\"\nexport * from \"./RotateCertificatesDialog.vue?vue&type=script&lang=js&\"\nimport style0 from \"./RotateCertificatesDialog.vue?vue&type=style&index=0&id=41281ab8&prod&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/@vue/cli-service/node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"41281ab8\",\n  null\n  \n)\n\nexport default component.exports","// Imports\nvar ___CSS_LOADER_API_IMPORT___ = require(\"../../node_modules/@vue/cli-service/node_modules/css-loader/dist/runtime/api.js\");\nexports = ___CSS_LOADER_API_IMPORT___(false);\n// Module\nexports.push([module.id, \".prompt-rotate[data-v-41281ab8]{margin:0}.buttons[data-v-41281ab8]{display:flex;justify-content:flex-end;width:100%}.options[data-v-41281ab8]{display:flex;flex-direction:column}.options .service-select[data-v-41281ab8]{margin-left:20px;margin-top:10px;width:-moz-fit-content;width:fit-content;min-width:260px}.rotate-modal[data-v-41281ab8].v--modal-box{border:none}.rotate-modal[data-v-41281ab8].v--modal-box .card-container{margin:0}.rotate-modal[data-v-41281ab8].v--modal-box .card-container .card-wrap{display:flex;flex-direction:column}.rotate-modal[data-v-41281ab8].v--modal-box .card-container .card-body{flex:1}.rotate-modal[data-v-41281ab8].v--modal-box .card-container .card-actions{align-self:center}\", \"\"]);\n// Exports\nmodule.exports = exports;\n","export * from \"-!../../node_modules/vue-style-loader/index.js??ref--9-oneOf-1-0!../../node_modules/@vue/cli-service/node_modules/css-loader/dist/cjs.js??ref--9-oneOf-1-1!../../node_modules/@vue/cli-service/node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--9-oneOf-1-2!../../node_modules/postcss-loader/src/index.js??ref--9-oneOf-1-3!../../node_modules/sass-loader/dist/cjs.js??ref--9-oneOf-1-4!../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js??vue-loader-options!./RotateCertificatesDialog.vue?vue&type=style&index=0&id=41281ab8&prod&lang=scss&scoped=true&\"","// style-loader: Adds some css to the DOM by adding a <style> tag\n\n// load the styles\nvar content = require(\"!!../../node_modules/@vue/cli-service/node_modules/css-loader/dist/cjs.js??ref--9-oneOf-1-1!../../node_modules/@vue/cli-service/node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--9-oneOf-1-2!../../node_modules/postcss-loader/src/index.js??ref--9-oneOf-1-3!../../node_modules/sass-loader/dist/cjs.js??ref--9-oneOf-1-4!../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js??vue-loader-options!./RotateCertificatesDialog.vue?vue&type=style&index=0&id=41281ab8&prod&lang=scss&scoped=true&\");\nif(content.__esModule) content = content.default;\nif(typeof content === 'string') content = [[module.id, content, '']];\nif(content.locals) module.exports = content.locals;\n// add the styles to the DOM\nvar add = require(\"!../../node_modules/vue-style-loader/lib/addStylesClient.js\").default\nvar update = add(\"51fe09e5\", content, true, {\"sourceMap\":false,\"shadowMode\":false});"],"sourceRoot":""}