(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages/c/_cluster/uiplugins/InstallDialog"],{"1c48":function(e,t,a){var n=a("5c02");n.__esModule&&(n=n.default),"string"===typeof n&&(n=[[e.i,n,""]]),n.locals&&(e.exports=n.locals);var i=a("499e").default;i("00ea486a",n,!0,{sourceMap:!1,shadowMode:!1})},"28f0":function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e._self._c;return t("modal",{attrs:{name:"installPluginDialog",height:"auto",scrollable:!0}},[e.plugin?t("div",{staticClass:"plugin-install-dialog"},[t("h4",{staticClass:"mt-10"},[e._v("\n      "+e._s(e.t("plugins.".concat(e.mode,".title"),{name:e.plugin.label}))+"\n    ")]),e._v(" "),t("div",{staticClass:"custom mt-10"},[t("div",{staticClass:"dialog-panel"},[t("p",[e._v("\n          "+e._s(e.t("plugins.".concat(e.mode,".prompt")))+"\n        ")]),e._v(" "),e.plugin.certified?e._e():t("Banner",{attrs:{color:"warning",label:e.t("plugins.install.warnNotCertified")}}),e._v(" "),e.showVersionSelector?t("LabeledSelect",{staticClass:"version-selector mt-10",attrs:{"label-key":"plugins.install.version",options:e.versionOptions,"data-testid":"install-ext-modal-select-version"},model:{value:e.version,callback:function(t){e.version=t},expression:"version"}}):t("div",[e._v("\n          "+e._s(e.t("plugins.install.version"))+" "+e._s(e.version)+"\n        ")])],1),e._v(" "),t("div",{staticClass:"dialog-buttons"},[t("button",{staticClass:"btn role-secondary",attrs:{disabled:e.busy,"data-testid":"install-ext-modal-cancel-btn"},on:{click:function(t){return e.closeDialog(!1)}}},[e._v("\n          "+e._s(e.t("generic.cancel"))+"\n        ")]),e._v(" "),t("AsyncButton",{attrs:{mode:e.buttonMode,"data-testid":"install-ext-modal-install-btn"},on:{click:e.install}})],1)])]):e._e()])},i=[],l=a("ade3"),s=a("1da1"),o=(a("4de4"),a("d3b7"),a("d81d"),a("7db0"),a("b0c0"),a("e260"),a("ddb0"),a("2ca0"),a("99af"),a("a34a")),r=a.n(o),c=(a("96cf"),a("67c9")),d=a("a95f"),u=a("a788"),p=a("7388"),v=a("7600"),g=a("01ba"),h={components:{AsyncButton:c["b"],Banner:g["a"],LabeledSelect:d["a"]},fetch:function(){var e=this;return Object(s["a"])(r.a.mark((function t(){return r.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$store.dispatch("management/find",{type:u["A"].SETTING,id:"system-default-registry"});case 2:e.defaultRegistrySetting=t.sent;case 3:case"end":return t.stop()}}),t)})))()},data:function(){return{currentVersion:"",defaultRegistrySetting:null,plugin:void 0,busy:!1,version:"",update:!1,mode:""}},computed:{showVersionSelector:function(){var e;return(null===(e=this.versionOptions)||void 0===e?void 0:e.length)>1},versionOptions:function(){var e,t,a=this;if(!this.plugin)return[];var n=null===(e=this.plugin)||void 0===e||null===(t=e.installableVersions)||void 0===t?void 0:t.filter((function(e){return!a.currentVersion||e.version!==a.currentVersion}));return n.map((function(e){return{label:e.version,value:e.version}}))},buttonMode:function(){return this.update?"update":"install"}},methods:{showDialog:function(e,t){var a,n,i,l,s=this;if(this.plugin=e,this.mode=t,this.version=e.displayVersion,"update"===t)this.currentVersion=e.displayVersion,(null===(n=e.installableVersions)||void 0===n?void 0:n.length)>0&&(this.version=null===(i=e.installableVersions)||void 0===i||null===(l=i[0])||void 0===l?void 0:l.version);else if("rollback"===t){var o=e.installableVersions.filter((function(t){return t.version!==e.displayVersion}));this.currentVersion=e.displayVersion,o.length>0&&(this.version=o[0].version)}var r,c,d=null===(a=e.installableVersions)||void 0===a?void 0:a.find((function(e){return e.version===s.version}));d||(this.version=null===(r=e.installableVersions)||void 0===r||null===(c=r[0])||void 0===c?void 0:c.version);this.busy=!1,this.update="install"!==t,this.$modal.show("installPluginDialog")},closeDialog:function(e){this.$modal.hide("installPluginDialog"),this.$emit("closed",e)},install:function(){var e=this;return Object(s["a"])(r.a.mark((function t(){var a,n,i,s,o,c,d,g,h,m,f,b,x,y,_,w,N,V,k,O,C;return r.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.busy=!0,s=e.plugin,e.$emit("update",s.name,"install"),o=null===(a=s.versions)||void 0===a?void 0:a.find((function(t){return t.version===e.version})),o){t.next=7;break}return e.busy=!1,t.abrupt("return");case 7:return c=!1,t.prev=8,t.next=11,e.$store.dispatch("catalog/getVersionInfo",{repoType:o.repoType,repoName:o.repoName,chartName:s.chart.chartName,versionName:e.version});case 11:h=t.sent,m=(null===h||void 0===h||null===(d=h.values)||void 0===d||null===(g=d.image)||void 0===g?void 0:g.repository)||"",c=m.startsWith("rancher/"),t.next=18;break;case 16:t.prev=16,t.t0=t["catch"](8);case 18:return f=!1,t.prev=19,t.next=22,e.$store.dispatch("management/find",{type:u["f"].APP,id:"".concat(v["k"],"/").concat(s.chart.chartName),opt:{force:!0}});case 22:b=t.sent,f=!!b,t.next=28;break;case 26:t.prev=26,t.t1=t["catch"](19);case 28:return x=o.repoType,y=o.repoName,_=e.$store.getters["catalog/repo"]({repoType:x,repoName:y}),w={chartName:s.chart.chartName,version:e.version,releaseName:s.chart.chartName,annotations:(n={},Object(l["a"])(n,p["e"].SOURCE_REPO_TYPE,s.repoType),Object(l["a"])(n,p["e"].SOURCE_REPO_NAME,s.repoName),n),values:{}},N=(null===(i=e.defaultRegistrySetting)||void 0===i?void 0:i.value)||"",c&&N&&(w.values.global=w.values.global||{},w.values.global.cattle=w.values.global.cattle||{},w.values.global.cattle.systemDefaultRegistry=N),V={charts:[w],namespace:v["k"]},k=f||e.update?"upgrade":"install",t.prev=36,t.next=39,_.doAction(k,V);case 39:return O=t.sent,C="".concat(O.operationNamespace,"/").concat(O.operationName),e.closeDialog(s),t.next=44,_.waitForOperation(C);case 44:return t.next=46,e.$store.dispatch("management/find",{type:u["f"].OPERATION,id:C});case 46:t.next=52;break;case 48:t.prev=48,t.t2=t["catch"](36),e.$store.dispatch("growl/error",{title:e.t("plugins.error.generic"),message:t.t2.message?t.t2.message:t.t2,timeout:1e4},{root:!0}),e.closeDialog(s);case 52:case"end":return t.stop()}}),t,null,[[8,16],[19,26],[36,48]])})))()}}},m=h,f=(a("d88e"),a("0c7c")),b=Object(f["a"])(m,n,i,!1,null,"24e3c204",null);t["default"]=b.exports},"5c02":function(e,t,a){var n=a("4bad");t=n(!1),t.push([e.i,".plugin-install-dialog[data-v-24e3c204]{padding:10px}.plugin-install-dialog h4[data-v-24e3c204]{font-weight:700}.plugin-install-dialog .dialog-panel[data-v-24e3c204]{display:flex;flex-direction:column;min-height:100px}.plugin-install-dialog .dialog-panel p[data-v-24e3c204]{margin-bottom:5px}.plugin-install-dialog .dialog-panel .dialog-info[data-v-24e3c204]{flex:1}.plugin-install-dialog .dialog-panel .toggle-advanced[data-v-24e3c204]{display:flex;align-items:center;cursor:pointer;margin:10px 0}.plugin-install-dialog .dialog-panel .toggle-advanced[data-v-24e3c204]:hover{text-decoration:none;color:var(--link)}.plugin-install-dialog .dialog-panel .version-selector[data-v-24e3c204]{margin:0 10px 10px 10px;width:auto}.plugin-install-dialog .dialog-buttons[data-v-24e3c204]{display:flex;justify-content:flex-end;margin-top:10px}.plugin-install-dialog .dialog-buttons[data-v-24e3c204]>:not(:last-child){margin-right:10px}",""]),e.exports=t},d88e:function(e,t,a){"use strict";a("1c48")}}]);
//# sourceMappingURL=InstallDialog.96b4c702.js.map