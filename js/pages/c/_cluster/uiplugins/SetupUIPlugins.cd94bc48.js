(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages/c/_cluster/uiplugins/SetupUIPlugins"],{"3c45":function(e,t,a){var n=a("cb60");n.__esModule&&(n=n.default),"string"===typeof n&&(n=[[e.i,n,""]]),n.locals&&(e.exports=n.locals);var r=a("499e").default;r("2102c3e6",n,!0,{sourceMap:!1,shadowMode:!1})},"45ca":function(e,t,a){"use strict";a("bcd1")},bcd1:function(e,t,a){var n=a("de22");n.__esModule&&(n=n.default),"string"===typeof n&&(n=[[e.i,n,""]]),n.locals&&(e.exports=n.locals);var r=a("499e").default;r("9f14f054",n,!0,{sourceMap:!1,shadowMode:!1})},c150:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e._self._c;return t("div",[t("IconMessage",{attrs:{vertical:!0,subtle:!1,icon:"icon-gear"},scopedSlots:e._u([{key:"message",fn:function(){return[t("h2",[e._v("\n        "+e._s(e.t("plugins.setup.title"))+"\n      ")]),e._v(" "),e.loading?e._e():t("div",[e.haveCharts?t("div",[t("p",[e._v("\n            "+e._s(e.t("plugins.setup.prompt.can"))+"\n          ")]),e._v(" "),t("AsyncButton",{staticClass:"enable-plugin-support",attrs:{mode:"enable",manual:!0,"current-phase":e.buttonState,"data-testid":"extension-enable-operator"},on:{click:e.enable}})],1):t("div",[t("p",[e._v("\n            "+e._s(e.t("plugins.setup.prompt.cant"))+"\n          ")])]),e._v(" "),e._l(e.errors,(function(a,n){return t("div",{key:n,staticClass:"plugin-setup-error"},[e._v("\n          "+e._s(a)+"\n        ")])}))],2)]},proxy:!0}])}),e._v(" "),t("Dialog",{attrs:{name:"confirm-uiplugins-setup",title:e.t("plugins.setup.install.title")},on:{closed:e.dialogClosed}},[[t("p",{staticClass:"mb-20"},[e._v("\n        "+e._s(e.t("plugins.setup.install.prompt"))+"\n      ")]),e._v(" "),e.isAnyRepoAvailableForInstall?t("Banner",{staticClass:"mb-20",attrs:{color:"info"}},[e._v("\n        "+e._s(e.t("plugins.setup.install.airgap"))+"\n      ")]):e._e(),e._v(" "),t("div",{staticClass:"mb-15"},[t("Checkbox",{attrs:{disabled:e.hasRancherUIPluginsRepo,primary:!0,"label-key":"plugins.setup.install.addRancherRepo","data-testid":"extension-enable-operator-official-repo"},model:{value:e.addRepos.official,callback:function(t){e.$set(e.addRepos,"official",t)},expression:"addRepos.official"}}),e._v(" "),e.hasRancherUIPluginsRepo?t("div",{staticClass:"checkbox-info"},[e._v("\n          ("+e._s(e.t("plugins.setup.installed"))+")\n        ")]):e._e()],1),e._v(" "),t("div",{staticClass:"mb-15"},[t("Checkbox",{attrs:{disabled:e.hasRancherUIPartnersPluginsRepo,primary:!0,"label-key":"plugins.setup.install.addPartnersRancherRepo","data-testid":"extension-enable-operator-partners-repo"},model:{value:e.addRepos.partners,callback:function(t){e.$set(e.addRepos,"partners",t)},expression:"addRepos.partners"}}),e._v(" "),e.hasRancherUIPartnersPluginsRepo?t("div",{staticClass:"checkbox-info"},[e._v("\n          ("+e._s(e.t("plugins.setup.installed"))+")\n        ")]):e._e()],1)]],2)],1)},r=[],s=(a("b64b"),a("a4d3"),a("4de4"),a("e439"),a("dbb4"),a("ade3")),o=a("1da1"),i=a("a34a"),c=a.n(i),l=(a("96cf"),a("07ac"),a("d3b7"),a("159b"),a("7db0"),a("e260"),a("ddb0"),a("99af"),a("e6cf"),a("b0c0"),a("f20a"),a("3ca3"),a("2f62")),u=a("67c9"),p=a("2678"),d=a("a788"),f=a("7388"),h=a("e5e4"),b=a("bd30"),g=a("01ba"),v=a("7600");function m(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function _(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?m(Object(a),!0).forEach((function(t){Object(s["a"])(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):m(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var R={components:{AsyncButton:u["b"],Checkbox:b["a"],Banner:g["a"],IconMessage:p["a"],Dialog:h["a"]},fetch:function(){var e=this;return Object(o["a"])(c.a.mark((function t(){var a,n,r;return c.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(a=e.$store.getters["catalog/rawCharts"],n=Object.values(a),r=[],v["h"].forEach((function(e){var t=n.find((function(t){return t.repoName===v["m"]&t.chartName===e}));t&&r.push(t)})),e.haveCharts=r.length===v["h"].length,!e.haveCharts){t.next=10;break}if(e.installCharts=r,!e.$store.getters["management/schemaFor"](d["f"].CLUSTER_REPO)){t.next=10;break}return t.next=10,e.$store.dispatch("management/findAll",{type:d["f"].CLUSTER_REPO,opt:{force:!0}});case 10:return t.next=12,e.$store.dispatch("management/find",{type:d["A"].SETTING,id:"system-default-registry"});case 12:e.defaultRegistrySetting=t.sent,e.loading=!1;case 14:case"end":return t.stop()}}),t)})))()},data:function(){return{loading:!0,haveCharts:!1,installCharts:[],errors:[],addRepos:{official:!0,partners:!0},reposInfo:{official:{name:v["e"],url:v["f"],branch:v["d"]},partners:{name:v["b"],url:v["c"],branch:v["a"]}},buttonState:u["a"].ACTION,defaultRegistrySetting:null}},computed:_(_({},Object(l["b"])({repos:"catalog/repos"})),{},{hasRancherUIPluginsRepo:function(){return!!this.repos.find((function(e){return e.urlDisplay===v["f"]}))},hasRancherUIPartnersPluginsRepo:function(){return!!this.repos.find((function(e){return e.urlDisplay===v["c"]}))},isAnyRepoAvailableForInstall:function(){return!this.hasRancherUIPluginsRepo||!this.hasRancherUIPartnersPluginsRepo}}),methods:{installChart:function(e){var t=this;return Object(o["a"])(c.a.mark((function a(){var n,r,o,i,l,u,p,h,b,g,m,_;return c.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return o=e.versions[0],i=o.repoType,l=o.repoName,u=t.$store.getters["catalog/repo"]({repoType:i,repoName:l}),p={chartName:e.chartName,version:o.version,releaseName:e.chartName,annotations:(n={},Object(s["a"])(n,f["e"].SOURCE_REPO_TYPE,i),Object(s["a"])(n,f["e"].SOURCE_REPO_NAME,l),n),values:{}},h=(null===(r=t.defaultRegistrySetting)||void 0===r?void 0:r.value)||"",h&&(p.values.global=p.values.global||{},p.values.global.cattle=p.values.global.cattle||{},p.values.global.cattle.systemDefaultRegistry=h),b={charts:[p],wait:!0,namespace:v["k"]},g="install",a.next=11,u.doAction(g,b);case 11:return m=a.sent,_="".concat(m.operationNamespace,"/").concat(m.operationName),a.next=15,u.waitForOperation(_);case 15:return a.abrupt("return",t.$store.dispatch("management/find",{type:d["f"].OPERATION,id:_}));case 16:case"end":return a.stop()}}),a)})))()},enable:function(){var e=this;return Object(o["a"])(c.a.mark((function t(){return c.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.errors=[],e.$emit("refreshCharts"),e.addRepos={official:!e.hasRancherUIPluginsRepo,partners:!e.hasRancherUIPartnersPluginsRepo},e.$modal.show("confirm-uiplugins-setup");case 4:case"end":return t.stop()}}),t)})))()},dialogClosed:function(e){var t=this;return Object(o["a"])(c.a.mark((function a(){return c.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(t.errors=[],!e){a.next=12;break}if(t.buttonState=u["a"].WAITING,!Object.values(t.addRepos).find((function(e){return e}))){a.next=6;break}return a.next=6,t.addDefaultHelmRepositories();case 6:return a.next=8,t.installPluginCharts();case 8:return a.next=10,new Promise((function(e){return setTimeout(e,5e3)}));case 10:t.buttonState=t.errors.length>0?u["a"].ERROR:u["a"].ACTION,t.$emit("done");case 12:case"end":return a.stop()}}),a)})))()},addDefaultHelmRepositories:function(){var e=this;return Object(o["a"])(c.a.mark((function t(){var a,n,r,s;return c.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:a=[],t.t0=c.a.keys(e.addRepos);case 2:if((t.t1=t.t0()).done){t.next=11;break}if(n=t.t1.value,!e.addRepos[n]){t.next=9;break}return t.next=7,e.$store.dispatch("management/create",{type:d["f"].CLUSTER_REPO,metadata:{name:e.reposInfo[n].name},spec:{gitBranch:e.reposInfo[n].branch,gitRepo:e.reposInfo[n].url}});case 7:r=t.sent,a.push(r.save());case 9:t.next=2;break;case 11:return t.next=13,Promise.allSettled(a);case 13:s=t.sent,s.forEach((function(t){"rejected"===t.status&&(console.error(t.reason),e.errors.push(t.reason))}));case 15:case"end":return t.stop()}}),t)})))()},installPluginCharts:function(){var e=this;return Object(o["a"])(c.a.mark((function t(){var a,n;return c.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:a=0;case 1:if(!(a<e.installCharts.length)){t.next=14;break}return n=e.installCharts[a],t.prev=3,t.next=6,e.installChart(n);case 6:t.next=11;break;case 8:t.prev=8,t.t0=t["catch"](3),e.errors.push(t.t0.message);case 11:a++,t.next=1;break;case 14:return t.abrupt("return",new Promise((function(e){return setTimeout(e,2e3)})));case 15:case"end":return t.stop()}}),t,null,[[3,8]])})))()}}},x=R,y=(a("f79d"),a("0c7c")),O=Object(y["a"])(x,n,r,!1,null,"77c3eb63",null);t["default"]=O.exports},cb60:function(e,t,a){var n=a("4bad");t=n(!1),t.push([e.i,".enable-plugin-support[data-v-77c3eb63]{font-size:14px;margin-top:20px}.plugin-setup-error[data-v-77c3eb63]{font-size:14px;color:var(--error);margin:10px 0 0 0}.checkbox-info[data-v-77c3eb63]{margin-left:20px;opacity:.7}",""]),e.exports=t},de22:function(e,t,a){var n=a("4bad");t=n(!1),t.push([e.i,".modal-dialog[data-v-5130a572]{padding:10px}.modal-dialog h4[data-v-5130a572]{font-weight:700}.modal-dialog .dialog-buttons[data-v-5130a572]{display:flex;justify-content:flex-end;margin-top:10px}.modal-dialog .dialog-buttons[data-v-5130a572]>:not(:last-child){margin-right:10px}",""]),e.exports=t},e5e4:function(e,t,a){"use strict";a("b0c0");var n=function(){var e=this,t=e._self._c;return t("modal",{attrs:{name:e.name,height:"auto",scrollable:!0},on:{closed:function(t){return e.closeDialog(!1)},"before-open":e.beforeOpen}},[t("div",{staticClass:"modal-dialog"},[t("h4",[e._v("\n      "+e._s(e.title)+"\n    ")]),e._v(" "),e._t("default"),e._v(" "),t("div",{staticClass:"dialog-buttons mt-20"},[e._t("buttons"),e._v(" "),e.$slots.buttons?e._e():t("div",[t("button",{staticClass:"btn role-secondary",on:{click:function(t){return e.closeDialog(!1)}}},[e._v("\n          "+e._s(e.t("generic.cancel"))+"\n        ")]),e._v(" "),e.mode?t("AsyncButton",{staticClass:"ml-10",attrs:{mode:e.mode},on:{click:e.ok}}):t("button",{staticClass:"btn role-primary ml-10",on:{click:function(t){return e.closeDialog(!0)}}},[e._v("\n          "+e._s(e.t("generic.ok"))+"\n        ")])],1)],2)],2)])},r=[],s=a("67c9"),o={components:{AsyncButton:s["b"]},props:{name:{type:String,required:!0},title:{type:String,required:!0},mode:{type:String,default:""}},data:function(){return{closed:!1}},methods:{beforeOpen:function(){this.closed=!1},ok:function(e){var t=this,a=function(a){e(a),a&&t.closeDialog(!0)};this.$emit("okay",a)},closeDialog:function(e){this.closed||(this.$modal.hide(this.name),this.$emit("closed",e),this.closed=!0)}}},i=o,c=(a("45ca"),a("0c7c")),l=Object(c["a"])(i,n,r,!1,null,"5130a572",null);t["a"]=l.exports},f79d:function(e,t,a){"use strict";a("3c45")}}]);
//# sourceMappingURL=SetupUIPlugins.cd94bc48.js.map